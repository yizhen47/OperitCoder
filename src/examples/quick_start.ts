/*
    æ¬¢è¿æ¥åˆ° TypeScript/JavaScript AI å·¥å…·å¼€å‘ç»ˆæå…¥é—¨æ•™ç¨‹ (v2.0 è¯¦ç»†ç‰ˆ)
    ====================================================================

    æœ¬æ•™ç¨‹ä¸ºåˆå­¦è€…è®¾è®¡ï¼Œç‰¹åˆ«æ˜¯é‚£äº›ç†Ÿæ‚‰å…¶ä»–è„šæœ¬è¯­è¨€ï¼ˆå¦‚Pythonï¼‰ä½†å¯¹TypeScript/JavaScriptä¸ç†Ÿæ‚‰çš„å¼€å‘è€…ã€‚
    æˆ‘ä»¬å°†ä»æœ€åŸºç¡€çš„è¯­æ³•å¼€å§‹ï¼Œä¸€æ­¥æ­¥å¸¦ä½ æ„å»ºä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€ç»“æ„ä¼˜é›…çš„AIå·¥å…·ï¼Œå¹¶è¯¦ç»†è§£é‡Šæ¯ä¸€æ­¥èƒŒåçš„â€œä¸ºä»€ä¹ˆâ€ã€‚
*/


// =================================================================
// Part 0: å…³äºè¿è¡Œç¯å¢ƒ (A Note on the Environment)
// =================================================================
/*
    åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦çŸ¥é“ï¼Œä½ çš„ä»£ç å¹¶ä¸æ˜¯åœ¨çœŸç©ºä¸­è¿è¡Œã€‚å®ƒåœ¨ä¸€ä¸ªç‰¹æ®Šçš„â€œæ²™ç®±â€ç¯å¢ƒä¸­æ‰§è¡Œã€‚
    è¿™ä¸ªç¯å¢ƒä¸ºä½ é¢„å…ˆæä¾›äº†ä¸€äº›å…¨å±€å¯ç”¨çš„å‡½æ•°å’Œå¯¹è±¡ï¼Œæœ€é‡è¦çš„æœ‰ï¼š

    1. `complete(result: object)`:
       - è¿™æ˜¯ä½ çš„å·¥å…·ä¸AIç³»ç»Ÿæ²Ÿé€šçš„ã€å”¯ä¸€ã€‘æ¡¥æ¢ã€‚
       - å½“ä½ çš„å·¥å…·æ‰§è¡Œå®Œæ¯•ï¼Œæ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½å¿…é¡»è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥è¿”å›ç»“æœã€‚
       - AIä¼šæ ¹æ®ä½ ä¼ å…¥è¿™ä¸ªå‡½æ•°çš„å¯¹è±¡å†…å®¹ï¼Œæ¥å†³å®šä¸‹ä¸€æ­¥çš„è¡Œä¸ºã€‚

    2. `exports`:
       - è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å¯¹è±¡ï¼Œä½ å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯ä½ ä»£ç æ–‡ä»¶çš„â€œå…¬å¼€æ¥å£â€ã€‚
       - ä½ éœ€è¦å°†ä½ çš„å·¥å…·å‡½æ•°â€œæŒ‚è½½â€åˆ° `exports` å¯¹è±¡ä¸Šï¼ŒAIæ‰èƒ½æ‰¾åˆ°å¹¶è°ƒç”¨å®ƒä»¬ã€‚
       - ç¤ºä¾‹: `exports.myToolName = myToolFunction;`

    3. `Tools`:
       - è¿™æ˜¯ä¸€ä¸ªå†…ç½®çš„å·¥å…·é›†ï¼Œæä¾›äº†å¾ˆå¤šå®ç”¨çš„è¾…åŠ©åŠŸèƒ½ï¼Œæ¯”å¦‚æ–‡ä»¶è¯»å†™ã€ç½‘ç»œè¯·æ±‚ã€ç³»ç»Ÿå‘½ä»¤ç­‰ã€‚
       - æˆ‘ä»¬åœ¨æœ¬æ•™ç¨‹ä¸­ä¼šç”¨åˆ° `Tools.System.sleep()` æ¥æ¼”ç¤ºå¼‚æ­¥æ“ä½œã€‚

    æœ¬æ•™ç¨‹çš„æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªTypeScriptæ–‡ä»¶ï¼ˆ.tsï¼‰ä¸­ã€‚TypeScriptæ˜¯JavaScriptçš„è¶…é›†ï¼Œå®ƒå¢åŠ äº†â€œç±»å‹ç³»ç»Ÿâ€ï¼Œ
    èƒ½å¸®åŠ©æˆ‘ä»¬ç¼–å†™æ›´å¥å£®ã€æ›´ä¸å®¹æ˜“å‡ºé”™çš„ä»£ç ã€‚
*/


// =================================================================
// Part 1: JavaScript / TypeScript æ ¸å¿ƒè¯­æ³•å¿«é€Ÿå…¥é—¨
// =================================================================
/*
    æœ¬éƒ¨åˆ†å°†è¯¦ç»†ä»‹ç»ç¼–å†™AIå·¥å…·å¿…éœ€çš„JS/TSè¯­æ³•ï¼Œå¹¶ä¸ºæ¯ä¸ªçŸ¥è¯†ç‚¹æä¾›ä»£ç ç¤ºä¾‹ã€‚
*/

// --- 1.1 å˜é‡å£°æ˜ (Variables) ---
/*
    - `const` (å¸¸é‡): ç”¨äºå£°æ˜ä¸€ä¸ªå€¼ä¸ä¼šå†æ”¹å˜çš„å˜é‡ã€‚è¿™æ˜¯é¦–é€‰çš„å£°æ˜æ–¹å¼ï¼Œèƒ½è®©ä»£ç æ›´å¯é¢„æµ‹ã€‚
    - `let` (å˜é‡): ç”¨äºå£°æ˜ä¸€ä¸ªå€¼å°†æ¥å¯èƒ½éœ€è¦è¢«ä¿®æ”¹çš„å˜é‡ã€‚
*/
function variable_example() {
    const toolName = "My Greeter Tool"; // ä¸€æ—¦è®¾å®šï¼ŒtoolNameå°±ä¸èƒ½å†è¢«èµ‹å€¼
    let executionCount = 0;           // executionCount çš„å€¼å¯ä»¥æ”¹å˜
    console.log(`å·¥å…·åç§°: ${toolName}`);

    executionCount = executionCount + 1;
    console.log(`è¿™æ˜¯ç¬¬ ${executionCount} æ¬¡æ‰§è¡Œã€‚`);

    // ä¸‹é¢è¿™è¡Œä»£ç ä¼šæŠ¥é”™ï¼Œå› ä¸º toolName æ˜¯ä¸€ä¸ªå¸¸é‡
    // toolName = "New Name";
}
// variable_example(); // ä½ å¯ä»¥å–æ¶ˆæ³¨é‡Šæ¥åœ¨æœ¬åœ°æµ‹è¯•è¿™äº›å‡½æ•°


// --- 1.2 æ•°æ®ç±»å‹ (Data Types) ---
/*
    TypeScript å¼ºåˆ¶æˆ‘ä»¬æ€è€ƒæ•°æ®çš„ç±»å‹ï¼Œè¿™æå¤§åœ°å‡å°‘äº†è¿è¡Œæ—¶é”™è¯¯ã€‚
    - `string`: æ–‡æœ¬å­—ç¬¦ä¸²ã€‚
    - `number`: æ•°å­—ï¼ˆæ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼‰ã€‚
    - `boolean`: å¸ƒå°”å€¼ (`true` æˆ– `false`)ã€‚
    - `object`: å¯¹è±¡ï¼Œé”®å€¼å¯¹çš„é›†åˆï¼Œç±»ä¼¼äºPythonçš„å­—å…¸ã€‚
    - `array`: æ•°ç»„ï¼Œæœ‰åºçš„æ•°æ®åˆ—è¡¨ï¼Œç±»ä¼¼äºPythonçš„åˆ—è¡¨ã€‚
    - `any`: ç‰¹æ®Šç±»å‹ï¼Œè¡¨ç¤ºâ€œä»»ä½•ç±»å‹éƒ½å¯ä»¥â€ã€‚åº”å°½é‡é¿å…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä¼šå‰Šå¼±TypeScriptçš„ä¼˜åŠ¿ã€‚
*/
function data_types_example() {
    // æˆ‘ä»¬å¯ä»¥æ˜ç¡®åœ°ä¸ºå˜é‡æ³¨è§£ç±»å‹
    const userName: string = "Alice";
    const userAge: number = 30;
    const isActive: boolean = true;

    // å¯¹è±¡ç±»å‹æ³¨è§£ï¼Œæè¿°äº†ä¸€ä¸ªå¯¹è±¡çš„â€œå½¢çŠ¶â€
    const userInfo: { name: string; age: number; premium: boolean } = {
        name: "Bob",
        age: 25,
        premium: false
    };
    console.log(`${userInfo.name} çš„å¹´é¾„æ˜¯ ${userInfo.age}`);

    // æ•°ç»„ç±»å‹æ³¨è§£ï¼Œ`string[]` è¡¨ç¤ºä¸€ä¸ªâ€œåªåŒ…å«å­—ç¬¦ä¸²çš„æ•°ç»„â€
    const permissions: string[] = ["read", "write", "execute"];
    console.log(`ç”¨æˆ·çš„ç¬¬ä¸€ä¸ªæƒé™æ˜¯: ${permissions[0]}`);

    // éå†æ•°ç»„
    permissions.forEach(permission => {
        console.log(`æƒé™: ${permission}`);
    });
}
// data_types_example();


// --- 1.3 å‡½æ•° (Functions) ä¸ å¼‚æ­¥æ“ä½œ (Async Operations) ---
/*
    - `async function`: è¿™æ˜¯å®šä¹‰AIå·¥å…·å‡½æ•°çš„æ ‡å‡†æ–¹å¼ã€‚`async` å…³é”®å­—è¡¨æ˜è¯¥å‡½æ•°å†…éƒ¨å¯èƒ½åŒ…å«éœ€è¦â€œç­‰å¾…â€çš„æ“ä½œã€‚
    - `await`: å¿…é¡»åœ¨ `async` å‡½æ•°å†…éƒ¨ä½¿ç”¨ã€‚å®ƒä¼šæš‚åœå‡½æ•°çš„æ‰§è¡Œï¼Œç›´åˆ°å…¶åçš„å¼‚æ­¥æ“ä½œï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ª`Promise`ï¼‰å®Œæˆï¼Œç„¶åè¿”å›ç»“æœã€‚
    - `Promise<T>`: ä»£è¡¨ä¸€ä¸ªå¼‚æ­¥æ“ä½œæœ€ç»ˆå®Œæˆï¼ˆæˆ–å¤±è´¥ï¼‰çš„ç»“æœã€‚`async` å‡½æ•°çš„è¿”å›å€¼æ€»æ˜¯ä¸€ä¸ª`Promise`ã€‚
      ä¾‹å¦‚ `Promise<string>` æ„å‘³ç€è¿™ä¸ªå¼‚æ­¥å‡½æ•°æœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚
*/
async function async_function_example(name: string): Promise<string> {
    console.log(`å¼€å§‹å‘ ${name} å‘é€é—®å€™...`);

    // `await` åœ¨è¿™é‡Œæš‚åœå‡½æ•°ï¼Œç­‰å¾… Tools.System.sleep(1500) å®Œæˆ
    // è¿™æ¨¡æ‹Ÿäº†ä¸€ä¸ªè€—æ—¶1.5ç§’çš„ç½‘ç»œè¯·æ±‚æˆ–æ–‡ä»¶æ“ä½œ
    await Tools.System.sleep(1500);

    const greetingMessage = `ä½ å¥½, ${name}! å¼‚æ­¥é—®å€™å·²é€è¾¾ã€‚`;
    console.log(greetingMessage);

    // async å‡½æ•°é€šè¿‡ return è¿”å›çš„å€¼ï¼Œä¼šè¢«åŒ…è£…åœ¨ Promise ä¸­
    return greetingMessage;
}
// async_function_example("Charlie");


// --- 1.4 é”™è¯¯å¤„ç† (Error Handling) ---
/*
    - `try...catch`: è¿™æ˜¯å¤„ç†æ½œåœ¨é”™è¯¯çš„æ ‡å‡†æ–¹å¼ï¼Œå¯¹äºå¥å£®çš„å·¥å…·è‡³å…³é‡è¦ã€‚
    - `throw new Error(...)`: å½“å‡½æ•°æ‰§è¡Œä¸ä¸‹å»æ—¶ï¼Œä¸»åŠ¨â€œæŠ›å‡ºâ€ä¸€ä¸ªé”™è¯¯ï¼Œä¸­æ–­å½“å‰`try`å—çš„æ‰§è¡Œï¼Œå¹¶è¢«`catch`å—æ•è·ã€‚
*/
function error_handling_example(input: any) {
    try {
        console.log("å°è¯•å¤„ç†è¾“å…¥...");

        // æ­¥éª¤1: æ£€æŸ¥è¾“å…¥æ˜¯å¦ä¸ºéç©ºå­—ç¬¦ä¸²
        if (typeof input !== 'string' || input.trim() === '') {
            // å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œå°±â€œæŠ›å‡ºâ€ä¸€ä¸ªé”™è¯¯å¯¹è±¡
            throw new Error("è¾“å…¥å¿…é¡»æ˜¯ä¸€ä¸ªéç©ºçš„å­—ç¬¦ä¸²ã€‚");
        }

        // æ­¥éª¤2: å¦‚æœä»£ç èƒ½æ‰§è¡Œåˆ°è¿™é‡Œï¼Œè¯´æ˜æ²¡æœ‰é”™è¯¯å‘ç”Ÿ
        console.log(`è¾“å…¥æœ‰æ•ˆï¼Œå†…å®¹æ˜¯: "${input}"`);
        return { success: true, data: input };

    } catch (error) {
        // æ­¥éª¤3: å¦‚æœ`try`å—ä¸­ä»»ä½•åœ°æ–¹æŠ›å‡ºäº†é”™è¯¯ï¼Œç¨‹åºä¼šç«‹å³è·³è½¬åˆ°è¿™é‡Œ
        console.error("å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯!");
        console.error(`é”™è¯¯è¯¦æƒ…: ${error.message}`); // error.message åŒ…å«äº†æˆ‘ä»¬æŠ›å‡ºæ—¶æä¾›çš„ä¿¡æ¯

        // åœ¨å®é™…å·¥å…·ä¸­ï¼Œè¿™é‡Œæˆ‘ä»¬ä¼šè°ƒç”¨ complete() æ¥æŠ¥å‘Šå¤±è´¥
        return { success: false, message: error.message };
    }
}
// error_handling_example("è¿™æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„è¾“å…¥");
// error_handling_example(""); // è¿™ä¸ªä¼šè§¦å‘é”™è¯¯
// error_handling_example(123); // è¿™ä¸ªä¹Ÿä¼šè§¦å‘é”™è¯¯


// =================================================================
// Part 2: AIå·¥å…·çš„æœ¬è´¨ ä¸ `complete()` å‡½æ•°
// =================================================================
/*
    å¦‚å‰æ‰€è¿°ï¼Œä¸€ä¸ªAIå·¥å…·å°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒé€šè¿‡ `complete()` å‡½æ•°ä¸AIç³»ç»Ÿäº¤äº’ã€‚
    ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€åŸºç¡€çš„ã€ç»“æ„å®Œæ•´çš„AIå·¥å…·ç¤ºä¾‹ï¼Œæˆ‘ä»¬ä¸ºå…¶ä¸­çš„å…³é”®éƒ¨åˆ†æ·»åŠ äº†æ³¨é‡Šã€‚
*/
async function simple_greeter_tool(params: { user_name: string }) {
    // å…¸å‹çš„å·¥å…·å‡½æ•°æ€»æ˜¯åœ¨ä¸€ä¸ªå¤§çš„ try...catch å—ä¸­
    try {
        // 1. ä» AI æ¥æ”¶åˆ°çš„å‚æ•°ä¸­è§£æ„å‡ºéœ€è¦çš„å€¼
        const { user_name } = params;

        // 2. å‚æ•°æ ¡éªŒï¼šæ°¸è¿œä¸è¦ç›¸ä¿¡è¾“å…¥ï¼
        if (!user_name) {
            throw new Error("å‚æ•° 'user_name' ç¼ºå¤±ï¼Œæ— æ³•ç”Ÿæˆé—®å€™è¯­ã€‚");
        }

        // 3. æ‰§è¡Œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘
        const greeting = `ä½ å¥½, ${user_name}! æ¬¢è¿æ¥åˆ°AIå·¥å…·çš„ä¸–ç•Œã€‚`;

        // 4. è°ƒç”¨ complete()ï¼ŒæŠ¥å‘ŠæˆåŠŸ
        //    - success: true è¡¨ç¤ºå·¥å…·æˆåŠŸå®Œæˆäº†å®ƒçš„ä»»åŠ¡ã€‚
        //    - data: å­˜æ”¾å·¥å…·çš„æ‰§è¡Œç»“æœï¼Œè¿™æ˜¯AIæœ€å…³å¿ƒçš„éƒ¨åˆ†ã€‚
        complete({
            success: true,
            data: greeting
        });

    } catch (error) {
        // 5. å¦‚æœ try å—ä¸­ä»»ä½•åœ°æ–¹å‡ºé”™ï¼ˆæ— è®ºæ˜¯å‚æ•°æ ¡éªŒè¿˜æ˜¯ä¸šåŠ¡é€»è¾‘ï¼‰ï¼Œéƒ½ä¼šè¿›å…¥è¿™é‡Œ
        console.error("simple_greeter_tool æ‰§è¡Œå¤±è´¥:", error);

        // 6. è°ƒç”¨ complete()ï¼ŒæŠ¥å‘Šå¤±è´¥
        //    - success: false å‘Šè¯‰AIä»»åŠ¡å¤±è´¥äº†ã€‚
        //    - message: å­˜æ”¾æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯ï¼Œå¸®åŠ©AIç†è§£å¤±è´¥åŸå› ã€‚
        complete({
            success: false,
            message: `å·¥å…·æ‰§è¡Œå¤±è´¥: ${error.message}`
        });
    }
}


// =================================================================
// Part 3: Metadata å’Œ å‡½æ•°å¯¼å‡º - è¿æ¥AIä¸ä»£ç çš„æ¡¥æ¢
// =================================================================
/*
    æˆ‘ä»¬å·²ç»å†™å¥½äº†å·¥å…·å‡½æ•°ï¼Œä½†AIå¦‚ä½•çŸ¥é“å®ƒçš„å­˜åœ¨ã€åŠŸèƒ½å’Œç”¨æ³•å‘¢ï¼Ÿ
    è¿™éœ€è¦ä¸¤æ ·ä¸œè¥¿ï¼š
    1. `METADATA` (å…ƒæ•°æ®): å°±åƒæ˜¯å·¥å…·çš„â€œè¯´æ˜ä¹¦â€ã€‚
    2. `exports` (å¯¼å‡º): åƒæ˜¯æŠŠå·¥å…·å‡½æ•°â€œæ³¨å†Œâ€åˆ°ç³»ç»Ÿé‡Œã€‚

    --- 3.1 è¯¦è§£ METADATA ---
    æ–‡ä»¶é¡¶éƒ¨çš„ ` METADATA ... ` æ³¨é‡Šå—å°±æ˜¯è¿™ä»½è¯´æ˜ä¹¦ã€‚AIåœ¨åŠ è½½æ—¶ä¼šè§£æå®ƒã€‚
    - `name`: (string) å·¥å…·é›†çš„å”¯ä¸€IDã€‚
    - `description`: (string) å¯¹æ•´ä¸ªå·¥å…·é›†çš„è¯¦ç»†æè¿°ã€‚
    - `tools`: (array) ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«æ­¤æ–‡ä»¶ä¸­æ‰€æœ‰å¯ç”¨çš„å·¥å…·ã€‚
      - `name`: (string) å•ä¸ªå·¥å…·çš„å‡½æ•°åã€‚è¿™ä¸ªåå­—ã€å¿…é¡»ã€‘å’Œåé¢ `exports` ä¸­ä½¿ç”¨çš„åå­—å®Œå…¨ä¸€è‡´ã€‚
      - `description`: (string) å¯¹è¿™ä¸ªå·¥å…·èƒ½åšä»€ä¹ˆçš„æ¸…æ™°æè¿°ã€‚AIä¼šæ ¹æ®è¿™ä¸ªæè¿°æ¥å†³å®šä½•æ—¶è°ƒç”¨å®ƒã€‚
      - `parameters`: (array) å®šä¹‰äº†æ­¤å·¥å…·éœ€è¦å“ªäº›å‚æ•°ã€‚
        - `name`: (string) å‚æ•°åã€‚
        - `description`: (string) å¯¹å‚æ•°ç”¨é€”çš„æè¿°ã€‚
        - `type`: (string) å‚æ•°çš„ç±»å‹ (e.g., 'string', 'number', 'boolean')ã€‚
        - `required`: (boolean) è¿™ä¸ªå‚æ•°æ˜¯å¦æ˜¯å¿…éœ€çš„ã€‚
*/

/* METADATA
{
    "name": "greeter_tool_v2",
    "description": "ä¸€ä¸ªæä¾›å¤šç§é—®å€™æ–¹å¼çš„æ•™å­¦å·¥å…·é›†ã€‚",
    "tools": [
        {
            "name": "greet",
            "description": "å‘æŒ‡å®šçš„äººå‘é€ä¸€ä¸ªæ ‡å‡†çš„é—®å€™ã€‚",
            "parameters": [
                {
                    "name": "user_name",
                    "description": "è¦é—®å€™çš„äººçš„åå­—ã€‚",
                    "type": "string",
                    "required": true
                }
            ]
        },
        {
            "name": "system_inspector",
            "description": "è·å–è®¾å¤‡æ‘˜è¦ä¿¡æ¯ï¼Œå¹¶åœ¨ç”¨æˆ·çš„HOMEç›®å½•ä¸‹æŸ¥æ‰¾ç¬¦åˆç‰¹å®šæ¨¡å¼çš„æ–‡ä»¶ã€‚",
            "parameters": [
                {
                    "name": "search_pattern",
                    "description": "ç”¨äºæ–‡ä»¶æœç´¢çš„é€šé…ç¬¦æ¨¡å¼ï¼Œä¾‹å¦‚ï¼š'*.txt' æˆ– 'documents/*.pdf'ã€‚",
                    "type": "string",
                    "required": true
                }
            ]
        }
    ]
}
*/

// --- 3.2 è¯¦è§£ exports ---
/*
    `exports` æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç­‰å¾…ä½ æ¥å¡«å……ã€‚
    ä½ å¿…é¡»å°†ä½ çš„å·¥å…·å‡½æ•°èµ‹å€¼ç»™ `exports` å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œå±æ€§åå¿…é¡»å’Œ `METADATA` ä¸­å®šä¹‰çš„å·¥å…· `name` å®Œå…¨ä¸€è‡´ã€‚
    åªæœ‰è¿™æ ·ï¼ŒAIæ‰èƒ½æŠŠâ€œè¯´æ˜ä¹¦â€å’Œâ€œå®é™…çš„å‡½æ•°å®ç°â€å…³è”èµ·æ¥ã€‚

    `exports.greet = simple_greeter_tool;`

    ä¸Šé¢è¿™è¡Œä»£ç çš„æ„æ€æ˜¯ï¼š
    â€œå½“AIæƒ³è¦è°ƒç”¨åä¸º 'greet' çš„å·¥å…·æ—¶ï¼Œè¯·æ‰§è¡Œ `simple_greeter_tool` è¿™ä¸ªå‡½æ•°ã€‚â€
    (æˆ‘ä»¬å°†åœ¨æ•™ç¨‹çš„æœ€åè¿›è¡Œç»Ÿä¸€å¯¼å‡ºï¼Œæ‰€ä»¥æš‚æ—¶æ³¨é‡Šæ‰è¿™è¡Œ)
*/


// =================================================================
// Part 4: IIFEæ¨¡å¼ - éš”ç¦»ä½œç”¨åŸŸï¼Œé¿å…ä»£ç å†²çª
// =================================================================
/*
    å½“é¡¹ç›®å˜å¤§ï¼Œä½ å¯èƒ½ä¼šå®šä¹‰å¾ˆå¤šè¾…åŠ©å‡½æ•°ã€å˜é‡ã€‚å¦‚æœéƒ½æ”¾åœ¨å…¨å±€ï¼ˆæ–‡ä»¶çš„é¡¶å±‚ï¼‰ï¼Œå¾ˆå®¹æ˜“ä¸å…¶ä»–å·¥å…·æˆ–ç³»ç»Ÿåº“äº§ç”Ÿå‘½åå†²çªã€‚
    IIFE (Immediately Invoked Function Expression - ç«‹å³è°ƒç”¨å‡½æ•°è¡¨è¾¾å¼) æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„ç»å…¸JSæ¨¡å¼ã€‚

    å®ƒçš„å†™æ³•æ˜¯ `(function() { ... })();`
    - `(function() { ... })` å®šä¹‰äº†ä¸€ä¸ªåŒ¿åå‡½æ•°ã€‚
    - æœ€åçš„ `()` è¡¨ç¤ºâ€œç«‹å³æ‰§è¡Œâ€è¿™ä¸ªåˆšåˆšå®šä¹‰çš„åŒ¿åå‡½æ•°ã€‚

    è¿™æ ·åšçš„å¥½å¤„æ˜¯åˆ›å»ºäº†ä¸€ä¸ªâ€œç§æœ‰ä½œç”¨åŸŸâ€ã€‚åœ¨IIFEå†…éƒ¨å£°æ˜çš„ä»»ä½•å˜é‡æˆ–å‡½æ•°ï¼Œåœ¨å¤–éƒ¨éƒ½æ˜¯ä¸å¯è§çš„ï¼Œä»è€Œé¿å…äº†æ±¡æŸ“å…¨å±€å‘½åç©ºé—´ã€‚
    æˆ‘ä»¬å¯ä»¥é€šè¿‡ `return` è¯­å¥ï¼Œæœ‰é€‰æ‹©æ€§åœ°å°†éœ€è¦å…¬å¼€çš„å‡½æ•°æš´éœ²å‡ºæ¥ã€‚
*/

// ä½¿ç”¨IIFEæ¨¡å¼é‡æ„æˆ‘ä»¬çš„é—®å€™å·¥å…·
const greeterToolBox = (function () {
    // --- è¿™é‡Œæ˜¯ç§æœ‰ä½œç”¨åŸŸ ---

    // `version` å’Œ `logWithTimestamp` åœ¨IIFEå¤–éƒ¨æ— æ³•è¢«è®¿é—®ï¼Œæ˜¯æˆ‘ä»¬çš„å†…éƒ¨å®ç°ç»†èŠ‚ã€‚
    const version = "2.0";

    function logWithTimestamp(message: string) {
        const timestamp = new Date().toLocaleTimeString();
        console.log(`[${timestamp}][v${version}] ${message}`);
    }

    // è¿™æ˜¯æˆ‘ä»¬çœŸæ­£çš„ä¸šåŠ¡é€»è¾‘å®ç°
    async function performGreeting(params: { user_name: string }) {
        try {
            logWithTimestamp(`å¼€å§‹æ‰§è¡Œé—®å€™å·¥å…·ï¼Œå‚æ•°: ${JSON.stringify(params)}`);
            const { user_name } = params;
            if (!user_name) {
                throw new Error("å‚æ•° 'user_name' ç¼ºå¤±ã€‚");
            }
            const greeting = `ä½ å¥½, ${user_name}! (æ¥è‡ªIIFEæ¨¡å¼ v${version})`;
            complete({ success: true, data: greeting });
        } catch (error) {
            logWithTimestamp(`é—®å€™å·¥å…·å¤±è´¥: ${error.message}`);
            complete({ success: false, message: error.message });
        }
    }

    // --- å…¬å¼€æ¥å£ ---
    // é€šè¿‡ return ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å°† `performGreeting` å‡½æ•°ä»¥ `greet` çš„åå­—æš´éœ²å‡ºå»ã€‚
    return {
        greet: performGreeting
        // å¦‚æœæœ‰å…¶ä»–å·¥å…·ï¼Œå¯ä»¥ç»§ç»­åœ¨è¿™é‡Œæš´éœ²: anotherTool: someInternalFunction
    };

})(); // æ³¨æ„è¿™é‡Œï¼Œå‡½æ•°è¢«ç«‹å³æ‰§è¡Œäº†

// ç°åœ¨ï¼ŒIIFEå·²ç»æ‰§è¡Œå®Œæ¯•ï¼Œ`greeterToolBox` å˜é‡åŒ…å«äº†æˆ‘ä»¬è¿”å›çš„å¯¹è±¡ã€‚
// æˆ‘ä»¬å¯ä»¥è¿™æ ·å¯¼å‡ºå®ƒï¼š
// `exports.greet = greeterToolBox.greet;`


// =================================================================
// Part 5: Wrapperæ¨¡å¼ - ç»ˆæå½¢æ€ï¼Œè®©ä»£ç æ›´å¥å£®ã€æ›´ç®€æ´
// =================================================================
/*
    è§‚å¯Ÿä¸Šé¢çš„ä»£ç ï¼Œå³ä½¿ä½¿ç”¨äº†IIFEï¼Œ`performGreeting` å‡½æ•°å†…éƒ¨ä»ç„¶æœ‰é‡å¤çš„ `try/catch` å’Œ `complete()` è°ƒç”¨ã€‚
    åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œé‡å¤çš„ä»£ç ï¼ˆboilerplateï¼‰æ˜¯ç»´æŠ¤çš„å™©æ¢¦ã€‚

    æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ª `wrapper` (åŒ…è£…å™¨) å‡½æ•°æ¥ç»ˆç»“è¿™ç§é‡å¤ã€‚
    Wrapper çš„èŒè´£éå¸¸æ¸…æ™°ï¼š
    1. æ¥æ”¶ä¸€ä¸ªâ€œæ ¸å¿ƒä¸šåŠ¡é€»è¾‘å‡½æ•°â€ä½œä¸ºè¾“å…¥ã€‚
    2. åœ¨å†…éƒ¨å»ºç«‹ `try/catch` å®‰å…¨ç½‘ã€‚
    3. è´Ÿè´£è°ƒç”¨æ ¸å¿ƒå‡½æ•°ï¼Œå¹¶ç­‰å¾…å…¶ç»“æœã€‚
    4. æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œéƒ½ç”±å®ƒæ¥è°ƒç”¨ `complete()` å¹¶è¿”å›æ ‡å‡†æ ¼å¼çš„ç»“æœã€‚

    è¿™æ ·ï¼Œæˆ‘ä»¬ç¼–å†™çš„å·¥å…·å‡½æ•°å°±å¯ä»¥å˜å¾—éå¸¸çº¯ç²¹ï¼šåªå…³å¿ƒè¾“å…¥ã€ä¸šåŠ¡å¤„ç†å’Œè¾“å‡ºï¼ˆé€šè¿‡`return`å’Œ`throw`ï¼‰ï¼Œ
    å®Œå…¨ä¸ç”¨ç†ä¼š `try/catch` å’Œ `complete` è¿™äº›æ¨¡æ¿ä»£ç ã€‚
*/

// --- æœ€ç»ˆçš„ã€æœ€æ¨èçš„å¼€å‘æ¨¡å¼ ---

const finalTool = (function () {

    // 1. å®šä¹‰æˆ‘ä»¬çš„é€šç”¨ Wrapper å‡½æ•°
    //    å®ƒæ¥æ”¶ä¸€ä¸ªæ ¸å¿ƒé€»è¾‘å‡½æ•°å’Œå…¶æ‰€éœ€çš„å‚æ•°ã€‚
    async function wrap(coreFunction: (params: any) => Promise<any>, params: any) {
        try {
            // è°ƒç”¨æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œå¹¶ä½¿ç”¨ await ç­‰å¾…å…¶å®Œæˆ
            const result = await coreFunction(params);

            // æ ¸å¿ƒé€»è¾‘æˆåŠŸè¿”å›ï¼ŒWrapperè´Ÿè´£åŒ…è£…æˆæ ‡å‡†æˆåŠŸå¯¹è±¡å¹¶è°ƒç”¨complete
            complete({
                success: true,
                message: "å·¥å…·æ‰§è¡ŒæˆåŠŸã€‚",
                data: result // å°†æ ¸å¿ƒå‡½æ•°çš„è¿”å›å€¼æ”¾å…¥dataå­—æ®µ
            });

        } catch (error: any) {
            console.error(`å·¥å…· [${coreFunction.name}] æ‰§è¡Œæ—¶æ•è·åˆ°é”™è¯¯:`, error);

            // æ ¸å¿ƒé€»è¾‘æŠ›å‡ºå¼‚å¸¸ï¼ŒWrapperè´Ÿè´£æ•è·å¹¶åŒ…è£…æˆæ ‡å‡†å¤±è´¥å¯¹è±¡
            complete({
                success: false,
                message: `é”™è¯¯: ${error.message}`, // å°†é”™è¯¯ä¿¡æ¯æ”¾å…¥messageå­—æ®µ
                error_stack: error.stack // é™„å¸¦å®Œæ•´çš„é”™è¯¯å †æ ˆä»¥ä¾›è°ƒè¯•
            });
        }
    }

    // =================================================
    //  æ ¸å¿ƒä¸šåŠ¡é€»è¾‘åŒº (Core Logic Functions)
    // =================================================

    // 2a. â€œé—®å€™â€å·¥å…·çš„æ ¸å¿ƒé€»è¾‘
    async function greet_core_logic(params: { user_name: string }): Promise<string> {
        if (!params.user_name || params.user_name.trim() === '') {
            throw new Error("user_name ä¸èƒ½ä¸ºç©ºã€‚");
        }
        const greeting = `ä½ å¥½, ${params.user_name}! è¿™æ˜¯ä¸€ä¸ªé‡‡ç”¨ç»ˆæWrapperæ¨¡å¼çš„å·¥å…·ã€‚`;
        return greeting;
    }

    // 2b. â€œç³»ç»Ÿæ£€æŸ¥å™¨â€å·¥å…·çš„æ ¸å¿ƒé€»è¾‘
    async function inspect_system_core_logic(params: { search_pattern: string }): Promise<object> {
        if (!params.search_pattern) {
            throw new Error("search_pattern ä¸èƒ½ä¸ºç©ºã€‚");
        }

        console.log(`å¼€å§‹ç³»ç»Ÿæ£€æŸ¥ï¼Œæœç´¢æ¨¡å¼: '${params.search_pattern}'`);

        // ä¸ºäº†è®©é€»è¾‘æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°ã€é¡ºåºåœ°è°ƒç”¨å·¥å…·
        // 1. é¦–å…ˆï¼Œè·å–è®¾å¤‡ä¿¡æ¯
        console.log("æ­£åœ¨è·å–è®¾å¤‡ä¿¡æ¯...");
        const deviceInfo = await Tools.System.getDeviceInfo();
        console.log("è®¾å¤‡ä¿¡æ¯è·å–æˆåŠŸã€‚");

        // 2. ç„¶åï¼ŒæŸ¥æ‰¾æ–‡ä»¶
        console.log(`æ­£åœ¨ä¸»ç›®å½• ('~') ä¸‹æŸ¥æ‰¾æ–‡ä»¶ï¼Œæ¨¡å¼: '${params.search_pattern}'`);
        const foundFiles = await Tools.Files.find('~', params.search_pattern);
        console.log("æ–‡ä»¶æŸ¥æ‰¾æˆåŠŸã€‚");

        // ç»„åˆç»“æœå¹¶è¿”å›ä¸€ä¸ªç»“æ„åŒ–çš„å¯¹è±¡
        return {
            device: deviceInfo,
            files: foundFiles
        };
    }


    // =================================================
    //  å¯¼å‡ºå‡½æ•°å°è£…åŒº (Exported Functions)
    // =================================================

    // 3a. æš´éœ²ç»™AIçš„â€œé—®å€™â€å‡½æ•°
    async function greet_exported_function(params: { user_name: string }) {
        await wrap(greet_core_logic, params);
    }

    // 3b. æš´éœ²ç»™AIçš„â€œç³»ç»Ÿæ£€æŸ¥å™¨â€å‡½æ•°
    async function inspect_system_exported_function(params: { search_pattern: string }) {
        await wrap(inspect_system_core_logic, params);
    }


    // 4. ä»IIFEä¸­è¿”å›æ‰€æœ‰éœ€è¦å¯¼å‡ºçš„å·¥å…·
    return {
        greet: greet_exported_function,
        system_inspector: inspect_system_exported_function
    };

})();


// =================================================================
// Part 6: ä½¿ç”¨å†…ç½®å·¥å…·é›† (Using the Built-in `Tools`)
// =================================================================
/*
    æ²™ç®±ç¯å¢ƒæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å…¨å±€å¯¹è±¡ `Tools`ï¼Œå®ƒæ˜¯ä½ ä¸å¤–éƒ¨ä¸–ç•Œäº¤äº’çš„ä¸»è¦å…¥å£ã€‚
    `Tools` å¯¹è±¡è¢«ç»„ç»‡æˆå¤šä¸ªæ¨¡å—ï¼Œæ¯ä¸ªæ¨¡å—è´Ÿè´£ä¸€ç±»ç‰¹å®šçš„åŠŸèƒ½ã€‚

    ä¸»è¦çš„æ¨¡å—åŒ…æ‹¬ï¼š
    - `Tools.System`: ç³»ç»Ÿçº§æ“ä½œã€‚
      - `getDeviceInfo()`: è·å–è®¾å¤‡ä¿¡æ¯ï¼ˆå‹å·ã€æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç­‰ï¼‰ã€‚
      - `sleep(ms)`: è®©å·¥å…·æš‚åœæŒ‡å®šçš„æ¯«ç§’æ•°ã€‚
      - `exec(command)`: æ‰§è¡Œshellå‘½ä»¤ã€‚
    - `Tools.Files`: æ–‡ä»¶ç³»ç»Ÿæ“ä½œã€‚
      - `read(path)`: è¯»å–æ–‡ä»¶å†…å®¹ã€‚
      - `write(path, content)`: å†™å…¥å†…å®¹åˆ°æ–‡ä»¶ã€‚
      - `find(directory, pattern)`: åœ¨æŒ‡å®šç›®å½•ä¸­æŸ¥æ‰¾åŒ¹é…æ¨¡å¼çš„æ–‡ä»¶ã€‚
      - `remove(path)`: åˆ é™¤æ–‡ä»¶æˆ–ç›®å½•ã€‚
    - `Tools.Net`: ç½‘ç»œæ“ä½œã€‚
      - `fetch(url, options)`: å‘èµ·HTTPè¯·æ±‚ï¼Œç±»ä¼¼äºæµè§ˆå™¨ä¸­çš„`fetch`ã€‚
    - `Tools.UI`: ä¸è®¾å¤‡UIäº¤äº’ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰ã€‚
      - `getScreenshot()`: è·å–å½“å‰å±å¹•æˆªå›¾ã€‚
      - `findAndClick(text)`: æŸ¥æ‰¾å¹¶ç‚¹å‡»åŒ…å«ç‰¹å®šæ–‡æœ¬çš„UIå…ƒç´ ã€‚
    - `Tools.Memory`: è®°å¿†ç®¡ç†åŠŸèƒ½ã€‚
      - `query(query)`: æŸ¥è¯¢è®°å¿†åº“ã€‚
      - `create(title, content, ...)`: åˆ›å»ºæ–°è®°å¿†ã€‚
      - `update(oldTitle, updates)`: æ›´æ–°è®°å¿†ã€‚
      - `deleteMemory(title)`: åˆ é™¤è®°å¿†ã€‚
      - `link(sourceTitle, targetTitle, ...)`: é“¾æ¥è®°å¿†ã€‚
    - `Tools.FFmpeg`: éŸ³è§†é¢‘å¤„ç†ï¼ˆé«˜çº§åŠŸèƒ½ï¼‰ã€‚

    æ‰€æœ‰çš„ `Tools` å‡½æ•°éƒ½æ˜¯ã€å¼‚æ­¥ã€‘çš„ï¼Œæ„å‘³ç€ä½ å¿…é¡»ä½¿ç”¨ `await` æ¥è°ƒç”¨å®ƒä»¬ï¼Œ
    å¹¶ä¸”è°ƒç”¨å®ƒä»¬çš„ä»£ç å¿…é¡»ä½äº `async` å‡½æ•°å†…éƒ¨ã€‚

    åœ¨ä¸Šé¢çš„ `Part 5` ä¸­ï¼Œæˆ‘ä»¬å·²ç»ä¸ºä½ æ¼”ç¤ºäº†å¦‚ä½•å®ç°ä¸€ä¸ªåä¸º `system_inspector` çš„æ–°å·¥å…·ã€‚
    å®ƒå®Œç¾åœ°å±•ç¤ºäº†ï¼š
    1. å¦‚ä½•åœ¨æ ¸å¿ƒé€»è¾‘å‡½æ•°ä¸­è°ƒç”¨ `Tools.System.getDeviceInfo()` å’Œ `Tools.Files.find()`ã€‚
    2. å¦‚ä½•æŒ‰é¡ºåºåœ°è°ƒç”¨å¤šä¸ªå¼‚æ­¥å·¥å…·ï¼Œç­‰å¾…æ¯ä¸€ä¸ªæ“ä½œå®Œæˆåå†è¿›è¡Œä¸‹ä¸€æ­¥ã€‚
    3. å¦‚ä½•å°†è¿™äº›è°ƒç”¨é›†æˆåˆ°æˆ‘ä»¬å¥å£®çš„ `Wrapper` æ¨¡å¼ä¸­ã€‚

    è¯·å›å¤´ä»”ç»†é˜…è¯» `Part 5` ä¸­ `inspect_system_core_logic` å‡½æ•°çš„å®ç°ï¼Œ
    å®ƒæ˜¯ä½ å­¦ä¹ ä½¿ç”¨å†…ç½® `Tools` çš„æœ€ä½³èµ·ç‚¹ã€‚
*/


// ==========================================
// æœ€ç»ˆå¯¼å‡º (Final Export)
// ==========================================
// å°†æˆ‘ä»¬åœ¨æœ€ç»ˆIIFEæ¨¡å¼ä¸­è¿”å›çš„å‡½æ•°ï¼ŒæŒ‚è½½åˆ°exportsä¸Šã€‚
// è¿™é‡Œçš„ `greet` å’Œ `system_inspector` å¿…é¡»å’ŒMETADATAä¸­å®šä¹‰çš„å·¥å…· `name` å®Œå…¨ä¸€è‡´ã€‚
exports.greet = finalTool.greet;
exports.system_inspector = finalTool.system_inspector;

/*
    ğŸ“ æ­å–œ! ä½ å·²ç»å­¦å®Œäº†ä»é›¶åˆ°ä¸€çš„å®Œæ•´å¼€å‘æµç¨‹ã€‚

    ç°åœ¨å›é¡¾ä¸€ä¸‹æˆ‘ä»¬æ„å»ºæœ€ç»ˆä»£ç å½¢æ€çš„æ—…ç¨‹ï¼š
    1. **åŸºç¡€è¯­æ³•**: æŒæ¡äº†ç¼–å†™ä»£ç çš„åŸºæœ¬å·¥å…·ã€‚
    2. **åŸºç¡€å·¥å…·+complete()**: ç†è§£äº†AIå·¥å…·çš„æœ¬è´¨å’Œä¸ç³»ç»Ÿçš„äº¤äº’æ–¹å¼ã€‚
    3. **Metadata+exports**: å­¦ä¼šäº†å¦‚ä½•è®©AIâ€œå‘ç°â€å¹¶â€œä½¿ç”¨â€ä½ çš„å·¥å…·ã€‚
    4. **IIFEæ¨¡å¼**: å­¦ä¼šäº†å¦‚ä½•é€šè¿‡ä½œç”¨åŸŸéš”ç¦»æ¥ç»„ç»‡ä»£ç ï¼Œé¿å…å‘½åå†²çªï¼Œä½¿ä»£ç æ›´æ¨¡å—åŒ–ã€‚
    5. **Wrapperæ¨¡å¼**: å­¦ä¼šäº†å¦‚ä½•é€šè¿‡åˆ†ç¦»â€œä¸šåŠ¡é€»è¾‘â€å’Œâ€œæ¨¡æ¿ä»£ç â€æ¥ç¼–å†™æ›´ç®€æ´ã€æ›´å¥å£®ã€æ›´æ˜“äºç»´æŠ¤çš„å·¥å…·ä»£ç ã€‚
    6. **å†…ç½®å·¥å…· `Tools`**: å­¦ä¼šäº†å¦‚ä½•åˆ©ç”¨ç³»ç»Ÿæä¾›çš„å¼ºå¤§å·¥å…·ä¸æ–‡ä»¶ã€ç½‘ç»œå’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚

    è¿™å¥—â€œWrapper + IIFE + Toolsâ€çš„ç»„åˆæ˜¯ç»è¿‡å®è·µæ£€éªŒçš„æœ€ä½³å®è·µï¼Œå¼ºçƒˆå»ºè®®ä½ åœ¨å¼€å‘è‡ªå·±çš„å·¥å…·æ—¶é‡‡ç”¨å®ƒã€‚
*/ 