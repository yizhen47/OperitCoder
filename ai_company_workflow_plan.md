# AI 公司结构与 n8n 自动化工作流规划（MVP）

## 1. 目标
- 让你只需要提出需求，系统即可自动完成：规划、执行、审核、回报、最终决策。
- 降低“多层传话失真”，把流程从口头协作改成结构化协作。
- 通过标准化节点与验收规则，让流程可追踪、可复盘、可迭代。

## 2. 先批判原方案（问题清单）
1. `规划者` 与 `业务者` 职责边界模糊，容易重复解释需求。
2. 链路过长（多次转述），需求失真概率高。
3. 审核靠后，先做后挑刺，返工成本大。
4. 缺少机器可判定的验收标准，审核容易主观化。
5. 需求变更治理缺失：谁冻结范围、谁拍板、何时升级不清楚。
6. 缺少时限与迭代上限，容易进入无限循环。

## 3. 与公司级流程相比的主要不足
1. 缺少文档契约（需求、方案、验收用例）统一格式。
2. 缺少前置评审（需求评审/技术评审）机制。
3. 缺少明确关卡（DoR/DoD）与通过标准。
4. 缺少过程指标（返工率、缺陷率、周期、SLA）。
5. 缺少升级路径（超时/冲突时如何上升到你决策）。

## 4. 新增部门：组织与流程规划部（OPD）
> 这个部门是“元治理”，不是业务传话层。

### 4.1 职责
1. 负责组织结构设计与流程规则制定。
2. 维护角色边界、RACI、SOP、验收模板。
3. 做跨轮次复盘并发布流程版本（v1 -> v1.1）。

### 4.2 不做什么
1. 不直接改具体业务需求内容。
2. 不替代审核角色做实现细节裁决。
3. 不直接指挥 Codex 写代码。

### 4.3 放入现有链路的位置
1. 需求执行前：定义本轮规则与模板。
2. 需求执行中：监控是否按规则运行。
3. 需求结束后：复盘并更新流程版本。

## 5. 推荐组织结构（MVP）
1. 你（最终决策者）：目标与取舍的唯一拍板人。
2. OPD（组织与流程规划部）：制度与流程治理。
3. 规划者（Planner）：把需求转成执行契约。
4. 业务者（Operator/PM）：把契约打包给 Codex 并跟踪执行。
5. 审核者（Reviewer）：两阶段审核，负责质量门禁。
6. Codex（执行者）：实现代码与交付产物。

## 6. n8n 工作流（建议节点顺序）
1. `Intake`（你提交需求）
2. `OPD-Rules`（加载流程规则与模板版本）
3. `Planner`（产出执行契约 JSON）
4. `Review-A`（批判性建议，审计划合理性）
5. `Gate-A`（通过/打回）
6. `Operator`（组装 Codex 任务包）
7. `Codex-Execute`（执行并返回 diff/说明/未完成项）
8. `Review-B`（对照验收清单逐项查漏）
9. `Gate-B`（通过/打回）
10. `Triad-Summary`（规划者+业务者+审核联合摘要）
11. `Final-Decision`（你批准/拒绝/补充需求）
12. `OPD-Retrospective`（记录指标并更新流程版本）

## 7. 节点输入输出统一规范（关键）
全链路使用结构化 JSON，禁止纯自然语言传话。

### 7.1 通用字段
- `request_id`: 本轮唯一 ID
- `workflow_version`: 流程版本
- `status`: `approved | rejected | needs_revision | blocked`
- `reason`: 判定理由
- `next_action`: 下一步动作
- `owner`: 当前责任角色
- `deadline`: 当前节点截止时间

### 7.2 执行契约（Planner 输出）
- `goal`: 目标定义
- `scope_in`: 范围内
- `scope_out`: 范围外
- `tasks`: 任务拆解
- `acceptance_criteria`: 验收标准（可判定）
- `risks`: 风险与缓解
- `constraints`: 技术/时间/权限约束

### 7.3 Codex 交付包（Operator 输出）
- `task_bundle`: 可执行任务列表
- `context_files`: 文件范围
- `edit_rules`: 编辑规则
- `output_contract`: 产出格式（diff/说明/遗留项）

## 8. 审核机制（两阶段）
1. 阶段 A（策略审核）
- 目标：挑刺并优化计划，避免方向性错误。
- 失败条件：目标不清、范围不稳、验收不可测。

2. 阶段 B（实现审核）
- 目标：逐条对照验收标准，查漏补缺。
- 失败条件：任一验收项未满足、关键文件遗漏、交付不完整。

## 9. 治理规则（防止无限循环）
1. 设置 `max_iterations`（建议 2）。
2. 超过迭代上限自动升级到你裁决。
3. 每节点设置 `SLA`，超时标记 `blocked` 并告警。
4. 所有节点产物落盘归档，保证可追溯。

## 10. KPI（最小可用）
1. 首次通过率（Review-A / Review-B）。
2. 平均迭代次数。
3. 需求到交付总时长。
4. 打回原因分布（用于流程优化）。
5. 返工率与遗漏率。

## 11. MVP 启动建议
1. 先跑单项目、单仓库、单语言，降低变量。
2. 先启用 1 个审核者角色，不足再扩展。
3. 先固化 1 份验收模板（功能正确性 + 文件影响 + 风险说明）。
4. 每周由 OPD 发布一次小版本流程修订。

---

## 附：一句话定义各角色
- 你：定目标和取舍。
- OPD：定规则和演进流程。
- 规划者：把目标变成可执行契约。
- 业务者：把契约变成可执行任务包。
- Codex：把任务包变成代码与交付。
- 审核者：保证方向正确且交付完整。